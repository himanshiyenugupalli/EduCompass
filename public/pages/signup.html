<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EduCompass - Create Account</title>
<link rel="stylesheet" href="../css/styles.css">
</head>
<body>
<header>
  <h1>EduCompass</h1>
  <p>Your trusted platform to discover IT & Management colleges in India</p>
</header>

<main>
  <section id="authSection" aria-label="User Authentication">
    <form id="signupForm" aria-label="Signup form" novalidate>
      <h2>Create New Account</h2>
      <label for="signupName">Full Name</label>
      <input type="text" id="signupName" name="signupName" required autocomplete="name" />
      <div class="error-message" id="signupNameError"></div>

      <label for="signupEmail">Email</label>
      <input type="email" id="signupEmail" name="signupEmail" required autocomplete="email" />
      <div class="error-message" id="signupEmailError"></div>

      <label for="signupPassword">Password</label>
      <input type="password" id="signupPassword" name="signupPassword" required minlength="6" autocomplete="new-password" />
      <div class="error-message" id="signupPasswordError"></div>

      <label for="signupPasswordConfirm">Confirm Password</label>
      <input type="password" id="signupPasswordConfirm" name="signupPasswordConfirm" required minlength="6" autocomplete="new-password" />
      <div class="error-message" id="signupPasswordConfirmError"></div>

      <button type="submit">Create Account</button>
      <div class="toggle-link">
        Already have an account? <a href="login.html">Login here</a>
      </div>
    </form>
  </section>
</main>

<footer>
  &copy; 2025 EduCompass. Data is regularly updated for accuracy.
</footer>

<script src="../js/auth.js"></script>
<script>
  const signupForm = document.getElementById('signupForm');
  const signupNameError = document.getElementById('signupNameError');
  const signupEmailError = document.getElementById('signupEmailError');
  const signupPasswordError = document.getElementById('signupPasswordError');
  const signupPasswordConfirmError = document.getElementById('signupPasswordConfirmError');

  const errorIds = ['signupNameError', 'signupEmailError', 'signupPasswordError', 'signupPasswordConfirmError'];

  function validateSignup(name, email, password, passwordConfirm) {
    let valid = true;
    clearAllErrors(errorIds);

    if (!name) {
      showError('signupNameError', 'Full name is required.');
      valid = false;
    }

    if (!email) {
      showError('signupEmailError', 'Email is required.');
      valid = false;
    } else if (!isValidEmail(email)) {
      showError('signupEmailError', 'Please enter a valid email.');
      valid = false;
    }

    if (!password) {
      showError('signupPasswordError', 'Password is required.');
      valid = false;
    } else if (password.length < 6) {
      showError('signupPasswordError', 'Password must be at least 6 characters.');
      valid = false;
    }

    if (!passwordConfirm) {
      showError('signupPasswordConfirmError', 'Please confirm your password.');
      valid = false;
    } else if (password !== passwordConfirm) {
      showError('signupPasswordConfirmError', 'Passwords do not match.');
      valid = false;
    }

    return valid;
  }

  signupForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('signupName').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const password = document.getElementById('signupPassword').value.trim();
    const passwordConfirm = document.getElementById('signupPasswordConfirm').value.trim();
    
    if (!validateSignup(name, email, password, passwordConfirm)) return;

    const users = loadUsers();
    
    if (users[email]) {
      showError('signupEmailError', 'Email already registered. Please login instead.');
      return;
    }

    users[email] = {
      name: name,
      email: email,
      passwordHash: simpleHash(password)
    };
    
    saveUsers(users);
    setLoggedInUser(email);
    
    alert(`Account created successfully!\nWelcome to EduCompass, ${name}!\n\nYou will now be redirected to the college catalogue.`);
    
    // In a real application, you would redirect to the catalogue page
    // window.location.href = 'catalogue.html';
  });

  // Check if user is already logged in
  document.addEventListener('DOMContentLoaded', function() {
    const loggedInUser = getLoggedInUser();
    if (loggedInUser) {
      const users = loadUsers();
      const user = users[loggedInUser];
      if (user) {
        alert(`Welcome back, ${user.name}! You are already logged in.\n\nRedirecting to college catalogue...`);
        // window.location.href = 'catalogue.html';
      } else {
        clearLoggedInUser();
      }
    }
  });
</script>
</body>
</html>
