<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EduCompass - Login</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <h1>EduCompass</h1>
  <p>Your trusted platform to discover IT & Management colleges in India</p>
</header>

<main>
  <section id="authSection" aria-label="User Authentication">
    <form id="loginForm" aria-label="Login form" novalidate>
      <h2>Login</h2>
      <label for="loginEmail">Email</label>
      <input type="email" id="loginEmail" name="loginEmail" required autocomplete="username" />
      <div class="error-message" id="loginEmailError"></div>

      <label for="loginPassword">Password</label>
      <input type="password" id="loginPassword" name="loginPassword" required autocomplete="current-password" minlength="6" />
      <div class="error-message" id="loginPasswordError"></div>

      <button type="submit">Login</button>
      <div class="toggle-link">
        New user? <a href="signup.html">Create an account</a>
      </div>
    </form>
  </section>
</main>

<footer>
  &copy; 2025 EduCompass. Data is regularly updated for accuracy.
</footer>

<script src="auth.js"></script>
<script>
  const loginForm = document.getElementById('loginForm');
  const loginEmailError = document.getElementById('loginEmailError');
  const loginPasswordError = document.getElementById('loginPasswordError');

  const errorIds = ['loginEmailError', 'loginPasswordError'];

  function validateLogin(email, password) {
    let valid = true;
    clearAllErrors(errorIds);

    if (!email) {
      showError('loginEmailError', 'Email is required.');
      valid = false;
    } else if (!isValidEmail(email)) {
      showError('loginEmailError', 'Please enter a valid email.');
      valid = false;
    }

    if (!password) {
      showError('loginPasswordError', 'Password is required.');
      valid = false;
    } else if (password.length < 6) {
      showError('loginPasswordError', 'Password must be at least 6 characters.');
      valid = false;
    }

    return valid;
  }

  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    
    if (!validateLogin(email, password)) return;

    const users = loadUsers();
    const user = users[email];
    
    if (!user) {
      showError('loginEmailError', 'Email not found. Please create an account.');
      return;
    }

    if (user.passwordHash !== simpleHash(password)) {
      showError('loginPasswordError', 'Incorrect password. Please try again.');
      return;
    }

    setLoggedInUser(email);
    alert(`Login successful! Welcome back, ${user.name}!\n\nYou will now be redirected to the college catalogue.`);
    
    // In a real application, you would redirect to the catalogue page
    // window.location.href = 'catalogue.html';
  });

  // Check if user is already logged in
  document.addEventListener('DOMContentLoaded', function() {
    const loggedInUser = getLoggedInUser();
    if (loggedInUser) {
      const users = loadUsers();
      const user = users[loggedInUser];
      if (user) {
        alert(`Welcome back, ${user.name}! You are already logged in.\n\nRedirecting to college catalogue...`);
        // window.location.href = 'catalogue.html';
      } else {
        clearLoggedInUser();
      }
    }
  });
</script>
</body>
</html>
